<div class="tasks-container">
  <app-sidebar
    class="tasks-sidebar"
    [mode]="'container'"
    (statusChange)="setFilter($event)"
  ></app-sidebar>

  <div class="tasks-content">
    <div class="tasks-header">
      <div class="tasks-header-info">
        <h2>Tareas</h2>
        <p class="tasks-count">
          Total: <span id="totalCount">{{ pagination().count }}</span> tareas
        </p>
        <p class="tasks-count">Pagina {{ pagination().page }} de {{ pagination().totalPages }}</p>
        <label class="tasks-count" for="taskSort">
          Orden:
          <select id="taskSort" [value]="sortOption()" (change)="setSort($any($event.target).value)">
            <option value="created_desc">Mas recientes</option>
            <option value="created_asc">Mas antiguas</option>
            <option value="updated_desc">Actualizadas recientemente</option>
            <option value="title_asc">Titulo A-Z</option>
            <option value="title_desc">Titulo Z-A</option>
          </select>
        </label>
      </div>
      <button class="btn btn-primary" type="button" (click)="toggleCreateForm()">
        {{ showCreateForm() ? 'Cerrar' : 'Nueva tarea' }}
      </button>
    </div>

    @if (showCreateForm()) {
      <article class="task-form-card task-form-card--inline">
        <h3 class="form-title">Nueva tarea</h3>

        <form class="task-form" [formGroup]="createForm" (submit)="createTask()">
          <div class="form-group">
            <label for="newTaskTitle" class="form-label required">Titulo</label>
            <input
              type="text"
              id="newTaskTitle"
              class="form-input"
              formControlName="title"
              placeholder="Ingresa el titulo de la tarea"
            />
          </div>

          <div class="form-group">
            <label for="newTaskDescription" class="form-label">Descripcion</label>
            <textarea
              id="newTaskDescription"
              class="form-textarea"
              formControlName="description"
              placeholder="Ingresa una descripcion detallada de la tarea"
              rows="5"
            ></textarea>
          </div>

          <div class="form-group">
            <label for="newTaskCompleted" class="form-label">Estado</label>
            <div class="form-checkbox-group">
              <input
                type="checkbox"
                id="newTaskCompleted"
                class="form-checkbox"
                formControlName="completed"
              />
              <label for="newTaskCompleted" class="form-checkbox-label">Marcar como completada</label>
            </div>
          </div>

          <div class="form-actions">
            <button type="button" class="btn btn-secondary" (click)="toggleCreateForm()">
              Cancelar
            </button>
            <button
              type="submit"
              class="btn btn-primary"
              [disabled]="createForm.invalid && createForm.touched"
            >
              Crear tarea
            </button>
          </div>
        </form>
      </article>
    }

    <div class="tasks-list">
      @if (loading() && filteredTasks().length === 0) {
        <div class="task-cards-grid">
          @for (item of skeletonItems; track $index) {
            <app-task-card [loading]="true" (delete_)="deletingTask($event)"></app-task-card>
          }
        </div>
      } @else {
        <div class="task-cards-grid">
          @for (task of filteredTasks(); track task.id) {
            <app-task-card [task]="task" (delete_)="deletingTask($event)"></app-task-card>
          }
        </div>
      }

      @if (!loading() && filteredTasks().length === 0) {
        <div class="empty-state">
          <p>No hay tareas para mostrar</p>
        </div>
      }

      @if (pagination().totalPages > 1) {
        <div class="pagination-controls">
          <button
            class="btn btn-secondary"
            type="button"
            (click)="previousPage()"
            [disabled]="loading() || pagination().page <= 1"
          >
            Anterior
          </button>
          <span class="pagination-status">
            Pagina {{ pagination().page }} de {{ pagination().totalPages }}
          </span>
          <button
            class="btn btn-secondary"
            type="button"
            (click)="nextPage()"
            [disabled]="loading() || pagination().page >= pagination().totalPages"
          >
            Siguiente
          </button>
        </div>
      }
    </div>
  </div>
</div>
