<div class="auth-container">
  <div class="auth-card">
    <h2>Reset password</h2>

    @if (hashErrorMessage) {
      <div class="error-message">
        {{ hashErrorMessage }}
      </div>
      <div class="auth-links">
        <a routerLink="/forgot-password">Request a new link</a>
      </div>
    } @else {
      <form [formGroup]="resetPasswordForm" (ngSubmit)="onSubmit()">
        <div class="form-group">
          <label for="password">New password</label>
          <input
            id="password"
            type="password"
            formControlName="password"
            placeholder="At least 6 characters"
            [class.invalid]="passwordControl?.invalid && passwordControl?.touched"
          />
          @if (passwordControl?.invalid && passwordControl?.touched) {
            <div class="error-message">
              @if (passwordControl?.errors?.['required']) {
                <span>Password is required</span>
              }
              @if (passwordControl?.errors?.['minlength']) {
                <span>Password must be at least 6 characters</span>
              }
            </div>
          }
        </div>

        <div class="form-group">
          <label for="confirmPassword">Confirm password</label>
          <input
            id="confirmPassword"
            type="password"
            formControlName="confirmPassword"
            placeholder="Re-enter your password"
            [class.invalid]="
              (confirmPasswordControl?.invalid && confirmPasswordControl?.touched) ||
              (resetPasswordForm.errors?.['passwordMismatch'] && confirmPasswordControl?.touched)
            "
          />
          @if (confirmPasswordControl?.invalid && confirmPasswordControl?.touched) {
            <div class="error-message">
              @if (confirmPasswordControl?.errors?.['required']) {
                <span>Please confirm your password</span>
              }
            </div>
          }
          @if (resetPasswordForm.errors?.['passwordMismatch'] && confirmPasswordControl?.touched) {
            <div class="error-message">Passwords do not match</div>
          }
        </div>

        @if (apiErrorMessage) {
          <div class="error-message">{{ apiErrorMessage }}</div>
        }

        @if (successMessage) {
          <div class="success-message">{{ successMessage }}</div>
        }

        <button type="submit" class="btn-primary" [disabled]="isSubmitting || resetPasswordForm.invalid">
          @if (isSubmitting) {
            <span>Updating...</span>
          } @else {
            <span>Update Password</span>
          }
        </button>
      </form>
    }
  </div>
</div>
